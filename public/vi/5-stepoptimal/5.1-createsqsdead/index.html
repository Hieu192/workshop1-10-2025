<!doctype html><html lang=vi class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.150.0"><meta name=description content><meta name=author content="journeyoftheaverageguy@gmail.com"><link rel=icon href=/workshop1-10-2025/images/favicon.png type=image/png><title>Cấu hình hàng đợi thư chết :: Bắt đầu với Amazon VPC và AWS VPN Site to Site</title><link href=/workshop1-10-2025/css/nucleus.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/fontawesome-all.min.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/hybrid.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/featherlight.min.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/perfect-scrollbar.min.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/auto-complete.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/atom-one-dark-reasonable.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/theme.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/hugo-theme.css?1761751819 rel=stylesheet><link href=/workshop1-10-2025/css/theme-workshop.css?1761751819 rel=stylesheet><script src=/workshop1-10-2025/js/jquery-3.3.1.min.js?1761751819></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/workshop1-10-2025/vi/5-stepoptimal/5.1-createsqsdead/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=/workshop01-AWS-FCJ-2024/><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label>
<input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/workshop1-10-2025/js/lunr.min.js?1761751819></script><script type=text/javascript src=/workshop1-10-2025/js/auto-complete.js?1761751819></script><script type=text/javascript>var baseurl="https://Hieu192.github.io/workshop1-10-2025//vi"</script><script type=text/javascript src=/workshop1-10-2025/js/search.js?1761751819></script></div><div class=highlightable><ul class=topics><li data-nav-id=/workshop1-10-2025/vi/1-introduce/ title="Giới thiệu" class=dd-item><a href=/workshop1-10-2025/vi/1-introduce/><b>1. </b>Giới thiệu
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/2-preparationsteps/ title="Các bước chuẩn bị" class=dd-item><a href=/workshop1-10-2025/vi/2-preparationsteps/><b>2. </b>Các bước chuẩn bị
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshop1-10-2025/vi/2-preparationsteps/2.1-createtabledynamo/ title="Tạo DynamoDB Tables" class=dd-item><a href=/workshop1-10-2025/vi/2-preparationsteps/2.1-createtabledynamo/><b>2.1 </b>Tạo DynamoDB Tables
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/2-preparationsteps/2.2-createiam/ title="Tạo IAM Roles" class=dd-item><a href=/workshop1-10-2025/vi/2-preparationsteps/2.2-createiam/><b>2.2 </b>Tạo IAM Roles
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/2-preparationsteps/2.3-createlambda/ title="Tạo Lambda Functions" class=dd-item><a href=/workshop1-10-2025/vi/2-preparationsteps/2.3-createlambda/><b>2.3 </b>Tạo Lambda Functions
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshop1-10-2025/vi/3-processorderhandler/ title="Tạo luồng xử lý bất đồng bộ" class=dd-item><a href=/workshop1-10-2025/vi/3-processorderhandler/><b>3. </b>Tạo luồng xử lý bất đồng bộ
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshop1-10-2025/vi/3-processorderhandler/3.1-createsqs/ title="Tạo hàng đợi SQS" class=dd-item><a href=/workshop1-10-2025/vi/3-processorderhandler/3.1-createsqs/><b>3.1 </b>Tạo hàng đợi SQS
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/3-processorderhandler/3.2-createeventbridgerule/ title="Chuẩn bị Trung tâm điều phối (Amazon EventBridge)" class=dd-item><a href=/workshop1-10-2025/vi/3-processorderhandler/3.2-createeventbridgerule/><b>3.2 </b>Chuẩn bị Trung tâm điều phối (Amazon EventBridge)
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/3-processorderhandler/3.3-triggerlambdatosqs/ title="Kết nối SQS với Lambda" class=dd-item><a href=/workshop1-10-2025/vi/3-processorderhandler/3.3-triggerlambdatosqs/><b>3.3 </b>Kết nối SQS với Lambda
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshop1-10-2025/vi/4-apigateway/ title="Triển khai API Gateway" class=dd-item><a href=/workshop1-10-2025/vi/4-apigateway/><b>4. </b>Triển khai API Gateway
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshop1-10-2025/vi/4-apigateway/4.1-createrestapi/ title="Tạo Rest API" class=dd-item><a href=/workshop1-10-2025/vi/4-apigateway/4.1-createrestapi/><b>4.1 </b>Tạo Rest API
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/4-apigateway/4.2-testapi/ title="Test API trên Postman" class=dd-item><a href=/workshop1-10-2025/vi/4-apigateway/4.2-testapi/><b>4.2 </b>Test API trên Postman
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshop1-10-2025/vi/5-stepoptimal/ title="Những bước nâng cao tối ưu" class="dd-item
parent"><a href=/workshop1-10-2025/vi/5-stepoptimal/><b>5. </b>Những bước nâng cao tối ưu
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshop1-10-2025/vi/5-stepoptimal/5.1-createsqsdead/ title="Cấu hình hàng đợi thư chết" class="dd-item
active"><a href=/workshop1-10-2025/vi/5-stepoptimal/5.1-createsqsdead/><b>5.1 </b>Cấu hình hàng đợi thư chết
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/5-stepoptimal/5.2-createindex/ title="Tạo Global Secondary Index cho OrderingTable" class=dd-item><a href=/workshop1-10-2025/vi/5-stepoptimal/5.2-createindex/><b>5.2 </b>Tạo Global Secondary Index cho OrderingTable
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshop1-10-2025/vi/6-cognito/ title="Triển khai Cognito để bảo vệ API" class=dd-item><a href=/workshop1-10-2025/vi/6-cognito/><b>6. </b>Triển khai Cognito để bảo vệ API
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/workshop1-10-2025/vi/6-cognito/6.1-createuserpool/ title="Tạo User Pool" class=dd-item><a href=/workshop1-10-2025/vi/6-cognito/6.1-createuserpool/><b>6.1 </b>Tạo User Pool
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/6-cognito/6.2-configureapigateway/ title="Cấu hình Authorizer cho API Gateway" class=dd-item><a href=/workshop1-10-2025/vi/6-cognito/6.2-configureapigateway/><b>6.2 </b>Cấu hình Authorizer cho API Gateway
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/6-cognito/6.3-updatecodelambda/ title="Cập nhật code Lambda để sử dụng token" class=dd-item><a href=/workshop1-10-2025/vi/6-cognito/6.3-updatecodelambda/><b>6.3 </b>Cập nhật code Lambda để sử dụng token
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/workshop1-10-2025/vi/6-cognito/6.4-createusertoken/ title="Tạo user và token để xác thực để sử dụng API" class=dd-item><a href=/workshop1-10-2025/vi/6-cognito/6.4-createusertoken/><b>6.4 </b>Tạo user và token để xác thực để sử dụng API
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/workshop1-10-2025/vi/7-cleanupresource/ title="Dọn dẹp tài nguyên" class=dd-item><a href=/workshop1-10-2025/vi/7-cleanupresource/><b>7. </b>Dọn dẹp tài nguyên
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=http://awsstudygroup.com><i class='fab fa-aws'></i> AWS Study Group - Blog</a></li><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj><i class='fab fa-facebook'></i> AWS Study Group - Nhóm FB</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://Hieu192.github.io/workshop1-10-2025/5-stepoptimal/5.1-createsqsdead/>English</option><option id=vi value=https://Hieu192.github.io/workshop1-10-2025/vi/5-stepoptimal/5.1-createsqsdead/ selected>Tiếng Việt</option></select>
<svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><font color=orange>26-11-2023</font></i>
</left><left><br><br><b>Team</b><br><i><a href=https://www.linkedin.com/in/jotaguy style=color:orange>Gia Hưng</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title='Edit this page' href=https://ntdung93.github.io/workshop01-AWS-FCJ-2024/5-StepOptimal/5.1-CreateSQSDead/_index.vi.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i>
</a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links><a href=/workshop1-10-2025/vi/>Triển khai fullstack app với kiến trúc ba tầng</a> > <a href=/workshop1-10-2025/vi/5-stepoptimal/>Những bước nâng cao tối ưu</a> > Cấu hình hàng đợi thư chết</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Cấu hình hàng đợi thư chết</h1><h4 id=vì-sao-chúng-ta-cần-tạo-dead-letter-queue-dlq>Vì sao chúng ta cần tạo Dead-Letter Queue (DLQ)?</h4><ul><li>Chúng ta cần Dead-Letter Queue (DLQ) để lưu lại các message bị xử lý lỗi nhiều lần, giúp:<ul><li>Phân tích nguyên nhân lỗi mà không mất dữ liệu.</li><li>Tránh vòng lặp xử lý vô hạn trong Lambda hoặc SQS.</li><li>Đảm bảo độ tin cậy và khả năng khôi phục của hệ thống.</li></ul></li></ul><h4 id=mục-tiêu>Mục tiêu</h4><ul><li>Tạo một hàng đợi &ldquo;rác&rdquo; (DLQ). Cấu hình OrderingQueue1 chính của chúng ta để nếu một tin nhắn (đơn hàng) bị xử lý lỗi 3 lần, nó sẽ tự động bị &ldquo;vứt&rdquo; sang hàng đợi DLQ này. Điều này giúp các đơn hàng tốt khác vẫn được xử lý bình thường.</li></ul><h4 id=thực-hành>Thực hành</h4><ol><li><p>Truy cập vào dịch vụ SQS:</p><ul><li>Click <strong>Create queue</strong></li><li>Name nhập: <strong><code>OrderingQueue1_DLQ</code></strong></li><li>Để mặc đinh hết, kéo xuống tận cùng và click <strong>Create queue</strong>
<img src="/workshop01-AWS-FCJ-2025/images/5-1/01.png?width=50pc" alt=AMI></li></ul></li><li><p>Ở giao diện danh sách hàng đợi SQS, click vào <strong>OrderingQueue1</strong> và click <strong>Edit</strong> ở góc phải</p><ul><li>Cuộn xuống tìm phần <strong>Dead-letter queue</strong> và click <strong>Enable</strong></li><li>Chọn DLQ mà bạn vừa tạo ở bước 1</li><li>Maximum receives nhập 3</li></ul></li></ol><div class="notices note"><p>Maximum receives có nghĩa là Lambda được phép thử xử lý một tin nhắn. Nếu nó báo lỗi (fail), SQS sẽ giữ lại và giao lại sau. Nếu quá trình này &ldquo;thất bại&rdquo; tổng cộng 3 lần, SQS sẽ từ bỏ và chuyển tin nhắn đó sang DLQ.</p></div><p><img src="/workshop01-AWS-FCJ-2025/images/5-1/02.png?width=50pc" alt=AMI></p><ol start=3><li><p>Test thử với DLQ</p><ul><li>Chúng ta cần phải sửa một chút code lambda function để mô phỏng lỗi để test DLQ</li><li>Truy cập vào dịch vụ Lambda, click <strong>OrderingFunction1</strong>, mở tab Code và thêm dòng này như ảnh dưới và click <strong>Deploy</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;!!! ĐANG TEST DLQ - CỐ TÌNH GÂY LỖI !!!&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#34;Đây là lỗi giả lập để test DLQ&#34;</span>);
</span></span></code></pre></div><p><img src="/workshop01-AWS-FCJ-2025/images/5-1/03.png?width=50pc" alt=AMI></p><ul><li>Mở Postman, gọi /basket/checkout 4 lần để test
<img src="/workshop01-AWS-FCJ-2025/images/5-1/04.png?width=50pc" alt=AMI></li><li>Truy cập lại SQS, và thấy tin nhắn của OrderingQueue có 3 tin nhắn đang chuyển đi, và OrderingQueue1_DLQ đang giữ 1 tin nhắn thành công.
<img src="/workshop01-AWS-FCJ-2025/images/5-1/05.png?width=50pc" alt=AMI></li><li>Đợi một lúc, tất cả tin nhắn lỗi đã được chuyển thành công an toàn vào DLQ.</li></ul></li><li><p>Xóa code mô phỏng lỗi trên lambda</p></li></ol><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/workshop1-10-2025/vi/5-stepoptimal/ title="Những bước nâng cao tối ưu"><i class="fa fa-chevron-left"></i></a>
<a class="nav nav-next" href=/workshop1-10-2025/vi/5-stepoptimal/5.2-createindex/ title="Tạo Global Secondary Index cho OrderingTable" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1e3px;overflow:scroll;position:absolute;top:-1e3px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/workshop1-10-2025/js/clipboard.min.js?1761751819></script><script src=/workshop1-10-2025/js/perfect-scrollbar.min.js?1761751819></script><script src=/workshop1-10-2025/js/perfect-scrollbar.jquery.min.js?1761751819></script><script src=/workshop1-10-2025/js/jquery.sticky.js?1761751819></script><script src=/workshop1-10-2025/js/featherlight.min.js?1761751819></script><script src=/workshop1-10-2025/js/highlight.pack.js?1761751819></script><script>hljs.initHighlightingOnLoad()</script><script src=/workshop1-10-2025/js/modernizr.custom-3.6.0.js?1761751819></script><script src=/workshop1-10-2025/js/learn.js?1761751819></script><script src=/workshop1-10-2025/js/hugo-learn.js?1761751819></script><link href=/workshop1-10-2025/mermaid/mermaid.css?1761751819 rel=stylesheet><script src=/workshop1-10-2025/mermaid/mermaid.js?1761751819></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>